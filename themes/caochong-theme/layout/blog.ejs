<!-- 博客列表页 -->
<div class="blog-container">
  <!-- 页面头部 -->
  <div class="blog-header">
    <h1 class="blog-title">
      <span class="title-text">博客文章</span>
      <span class="title-subtitle">Blog Articles</span>
    </h1>
    <p class="blog-description">
      分享技术见解，记录学习旅程
    </p>
  </div>

  <div class="blog-layout">
    <!-- 主内容区 -->
    <div class="blog-main">
      <!-- 文章列表 -->
      <div class="post-list">
        <%
          // 获取当前页的文章
          var posts = page.posts || site.posts.sort('date', -1);

          if (posts.length > 0) {
            posts.each(function(post) {
        %>
          <article class="post-card">
            <!-- 封面图 -->
            <% if (post.cover) { %>
              <a href="<%= url_for(post.path) %>" class="post-cover-link">
                <div class="post-cover">
                  <img src="<%= url_for(post.cover) %>" alt="<%= post.title %>" loading="lazy">
                  <div class="post-cover-overlay"></div>
                </div>
              </a>
            <% } %>

            <!-- 文章内容 -->
            <div class="post-content">
              <!-- 分类标签 -->
              <% if (post.categories && post.categories.length) { %>
                <a href="<%= url_for(post.categories.data[0].path) %>" class="post-category">
                  <svg viewBox="0 0 24 24" width="14" height="14">
                    <path fill="currentColor" d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>
                  </svg>
                  <%= post.categories.data[0].name %>
                </a>
              <% } %>

              <!-- 标题 -->
              <h2 class="post-card-title">
                <a href="<%= url_for(post.path) %>"><%= post.title %></a>
              </h2>

              <!-- 摘要 -->
              <% if (post.description || post.excerpt) { %>
                <p class="post-excerpt">
                  <%= strip_html(post.description || post.excerpt).substring(0, 150) %>...
                </p>
              <% } %>

              <!-- 元信息 -->
              <div class="post-meta">
                <time class="post-date">
                  <svg viewBox="0 0 24 24" width="16" height="16">
                    <path fill="currentColor" d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V9h14v10z"/>
                  </svg>
                  <%= post.date.format('YYYY-MM-DD') %>
                </time>

                <span class="post-dot">•</span>

                <span class="post-reading-time">
                  <svg viewBox="0 0 24 24" width="16" height="16">
                    <path fill="currentColor" d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"/>
                  </svg>
                  <%= Math.ceil(strip_html(post.content).length / 400) %> 分钟阅读
                </span>

                <!-- 标签 -->
                <% if (post.tags && post.tags.length) { %>
                  <span class="post-tags">
                    <% post.tags.slice(0, 3).each(function(tag) { %>
                      <a href="<%= url_for(tag.path) %>" class="post-tag">
                        #<%= tag.name %>
                      </a>
                    <% }); %>
                  </span>
                <% } %>
              </div>
            </div>
          </article>
        <%
            });
          } else {
        %>
          <div class="no-posts">
            <svg viewBox="0 0 24 24" width="48" height="48">
              <path fill="currentColor" d="M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V6h5.17l2 2H20v10zm-8-4h2v2h-2zm0-6h2v4h-2z"/>
            </svg>
            <p>暂无文章</p>
          </div>
        <% } %>
      </div>

      <!-- 分页 -->
      <% if (page.total > 1) { %>
        <nav class="pagination">
          <%
            var prevPage = page.prev_link ? url_for(page.prev_link) : null;
            var nextPage = page.next_link ? url_for(page.next_link) : null;
            var currentPage = page.current;
            var totalPages = page.total;
          %>

          <!-- 上一页 -->
          <% if (prevPage) { %>
            <a href="<%= prevPage %>" class="pagination-btn pagination-prev">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
              </svg>
              上一页
            </a>
          <% } else { %>
            <span class="pagination-btn pagination-prev disabled">
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
              </svg>
              上一页
            </span>
          <% } %>

          <!-- 页码 -->
          <div class="pagination-numbers">
            <%
              // 显示页码逻辑：始终显示第1页和最后一页，当前页前后各2页
              var startPage = Math.max(1, currentPage - 2);
              var endPage = Math.min(totalPages, currentPage + 2);

              // 第一页
              if (startPage > 1) {
            %>
              <a href="<%= url_for(page.base) %>" class="pagination-number">1</a>
              <% if (startPage > 2) { %>
                <span class="pagination-ellipsis">...</span>
              <% } %>
            <% } %>

            <!-- 中间页码 -->
            <% for (var i = startPage; i <= endPage; i++) { %>
              <% if (i === currentPage) { %>
                <span class="pagination-number active"><%= i %></span>
              <% } else { %>
                <a href="<%= url_for(page.base + (i === 1 ? '' : 'page/' + i + '/')) %>" class="pagination-number"><%= i %></a>
              <% } %>
            <% } %>

            <!-- 最后一页 -->
            <% if (endPage < totalPages) { %>
              <% if (endPage < totalPages - 1) { %>
                <span class="pagination-ellipsis">...</span>
              <% } %>
              <a href="<%= url_for(page.base + 'page/' + totalPages + '/') %>" class="pagination-number"><%= totalPages %></a>
            <% } %>
          </div>

          <!-- 下一页 -->
          <% if (nextPage) { %>
            <a href="<%= nextPage %>" class="pagination-btn pagination-next">
              下一页
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
              </svg>
            </a>
          <% } else { %>
            <span class="pagination-btn pagination-next disabled">
              下一页
              <svg viewBox="0 0 24 24" width="20" height="20">
                <path fill="currentColor" d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
              </svg>
            </span>
          <% } %>
        </nav>
      <% } %>
    </div>

    <!-- 侧边栏 -->
    <aside class="blog-sidebar">
      <!-- 搜索框（预留） -->
      <div class="sidebar-widget search-widget">
        <h3 class="widget-title">
          <svg viewBox="0 0 24 24" width="18" height="18">
            <path fill="currentColor" d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
          </svg>
          搜索
        </h3>
        <div class="search-box">
          <input type="text" id="sidebar-search-input" placeholder="搜索文章..." class="search-input">
          <a href="<%= url_for('/search/') %>" class="search-btn">
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
            </svg>
          </a>
        </div>
      </div>

      <script>
        // Sidebar search - press Enter to go to search page
        document.getElementById('sidebar-search-input')?.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            const query = this.value.trim();
            if (query) {
              window.location.href = '<%= url_for("/search/") %>?q=' + encodeURIComponent(query);
            } else {
              window.location.href = '<%= url_for("/search/") %>';
            }
          }
        });
      </script>

      <!-- 分类 -->
      <% if (site.categories.length) { %>
        <div class="sidebar-widget categories-widget">
          <h3 class="widget-title">
            <svg viewBox="0 0 24 24" width="18" height="18">
              <path fill="currentColor" d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>
            </svg>
            分类
          </h3>
          <ul class="category-list">
            <% site.categories.sort('name').each(function(category) { %>
              <li class="category-item">
                <a href="<%= url_for(category.path) %>" class="category-link">
                  <span class="category-name"><%= category.name %></span>
                  <span class="category-count"><%= category.length %></span>
                </a>
              </li>
            <% }); %>
          </ul>
        </div>
      <% } %>

      <!-- 标签云 -->
      <% if (site.tags.length) { %>
        <div class="sidebar-widget tags-widget">
          <h3 class="widget-title">
            <svg viewBox="0 0 24 24" width="18" height="18">
              <path fill="currentColor" d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"/>
            </svg>
            标签
          </h3>
          <div class="tag-cloud">
            <%
              var tags = site.tags.sort('name');
              var maxCount = 0;
              tags.each(function(tag) {
                if (tag.length > maxCount) maxCount = tag.length;
              });

              tags.each(function(tag) {
                var size = Math.floor((tag.length / maxCount) * 3) + 1;
            %>
              <a href="<%= url_for(tag.path) %>" class="tag-cloud-item" data-size="<%= size %>">
                <%= tag.name %>
              </a>
            <% }); %>
          </div>
        </div>
      <% } %>

      <!-- 热门文章 -->
      <%
        var popularPosts = site.posts.sort('date', -1).limit(5);
      %>
      <% if (popularPosts.length) { %>
        <div class="sidebar-widget popular-widget">
          <h3 class="widget-title">
            <svg viewBox="0 0 24 24" width="18" height="18">
              <path fill="currentColor" d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
            </svg>
            热门文章
          </h3>
          <ul class="popular-list">
            <% popularPosts.each(function(post, index) { %>
              <li class="popular-item">
                <a href="<%= url_for(post.path) %>" class="popular-link">
                  <span class="popular-number"><%= index + 1 %></span>
                  <span class="popular-title"><%= post.title %></span>
                </a>
              </li>
            <% }); %>
          </ul>
        </div>
      <% } %>
    </aside>
  </div>
</div>
